- id: '1612214008069'
  alias: Notify, In-App - David - Leaves Home
  description: ''
  trigger:
  - platform: zone
    entity_id: person.david
    zone: zone.home
    event: leave
  condition: []
  action:
  - service: persistent_notification.create
    data:
      message: David has left home
      title: David location change
  - service: notify.notify
    data:
      message: notify.notify - David has left home
  mode: single
- id: '1612383370390'
  alias: Lights - Track - PM - Family Room motion w/ TV off
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 004463f7dc98142da83bf46edb4a580c
    entity_id: binary_sensor.fam_rm_motion
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  - condition: state
    entity_id: binary_sensor.is_evening_sunset_or_dusk_or_dark
    state: 'on'
  - condition: state
    entity_id: switch.family_room_hub_watch_tivo
    state: 'off'
  - condition: state
    entity_id: switch.family_room_hub_watch_chromecast
    state: 'off'
  - condition: state
    entity_id: light.track_light
    state: 'off'
  action:
  - type: turn_on
    device_id: 62a9f350725fb1cc5f640c6273c6492f
    entity_id: light.track_light
    domain: light
    brightness_pct: 90
  - wait_for_trigger:
    - type: no_motion
      platform: device
      device_id: 004463f7dc98142da83bf46edb4a580c
      entity_id: binary_sensor.fam_rm_motion
      domain: binary_sensor
    timeout: 00:15:00
  - type: turn_off
    device_id: 62a9f350725fb1cc5f640c6273c6492f
    entity_id: light.track_light
    domain: light
  mode: restart
- id: '1612472693289'
  alias: Notify, In-App - David - Arrives Home
  description: ''
  trigger:
  - platform: zone
    entity_id: person.david
    zone: zone.home
    event: enter
  condition: []
  action:
  - service: persistent_notification.create
    data:
      message: David has arrived home
      title: David location change
  - service: notify.notify
    data:
      message: notify.notify - David has arrived home
  mode: single
- id: '1611662110335'
  alias: Notify, Voice - HASS - Startup
  description: ''
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - wait_for_trigger:
    - platform: device
      device_id: 9173ddf2d5129948c45618e4db554d94
      domain: media_player
      entity_id: media_player.family_room_home
      type: idle
    timeout: 00:01:00
  - service: script.announce_everywhere
    data:
      message: Home Assistant has restarted
  mode: single
- id: '1612722099278'
  alias: 'zy-Housekeeping: TTS Cache - Clear - Weekly'
  description: ''
  trigger:
  - platform: time
    at: 03:15:00
  condition:
  - condition: time
    weekday:
    - mon
  action:
  - service: tts.clear_cache
    data: {}
  - service: notify.persistent_notification
    data:
      message: TTS Cache has been cleared
      title: TTS Cache Clear
  mode: single
- id: '1612743069477'
  alias: Lights - Kitchen-Breakfast - Dusk - On/Off when motion (w/ script)
  description: ''
  trigger:
  - platform: state
    entity_id: group.kitchen_breakfast_motion
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  - condition: state
    entity_id: binary_sensor.is_evening_before_sunset
    state: 'on'
  - condition: and
    conditions:
    - condition: state
      entity_id: light.breakfast_rm_light
      state: 'off'
    - condition: state
      entity_id: light.kitchen_light
      state: 'off'
  - condition: numeric_state
    entity_id: sensor.ezm_2_breakfast_room_illuminance
    below: '25'
  action:
  - service: script.lights_to_level_kitchen_breakfast
    data:
      to_brightness: 95
  - wait_for_trigger:
    - type: no_motion
      platform: device
      device_id: 6b4f5f9ebb171d1de001849586ff28a7
      entity_id: binary_sensor.kitchen_motion
      domain: binary_sensor
    timeout: 00:10:00
  - service: script.lights_to_level_kitchen_breakfast
    data:
      to_brightness: 0
  mode: restart
- id: '1612793794186'
  alias: '00 - test dusk- before sunrise+30 to sunset +4 '
  description: ''
  trigger:
  - platform: time_pattern
    seconds: '00'
  condition:
  - condition: sun
    before_offset: 00:20:00
    before: sunset
    after: sunset
    after_offset: -00:20:00
  action:
  - type: turn_off
    device_id: 13ade04b2bd14f3bae908a70734f03f1
    entity_id: light.studio_light
    domain: light
  mode: single
- id: '1613318826292'
  alias: 00 - test proximity and person-state
  description: ''
  trigger:
  - platform: state
    entity_id: proximity.david_proximity_home
  condition:
  - condition: numeric_state
    entity_id: proximity.david_proximity_home
    above: '0.3'
  action:
  - service: notify.persistent_notification
    data:
      title: person or proximity change
      message: "David state: {{ states('person.david') }}. \nLoc: {{ state_attr(\"\
        person.david\",\"latitude\") }}, {{ state_attr(\"person.david\",\"longitude\"\
        ) }} (acc: {{ state_attr(\"person.david\",\"gps_accuracy\") }})\nDirection\
        \ of travel: {{ state_attr('proximity.david_proximity_home','dir_of_travel')\
        \ }}.\nDistance: {{ states('proximity.david_proximity_home') }}\n"
  mode: queued
  max: 10
- id: '1613396619724'
  alias: 'zy-Housekeeping: Re-enable Light Automations (House) after 1 hour'
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.light_automations_enabled
    to: 'off'
    for: 01:00:00
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    entity_id: input_boolean.light_automations_enabled
  - service: notify.persistent_notification
    data:
      title: Light Automations Re-enabled
      message: Light Automations Re-enabled.
  - service: script.announce_everywhere
    data:
      message: Light automations have been re-enabled.
  mode: single
- id: '1613409762770'
  alias: Notify, Voice - 3D Printer - Starting
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.octoprint_printing
    to: 'on'
  condition:
  - condition: state
    entity_id: sensor.davids_cell_do_not_disturb_sensor
    state: 'off'
  action:
  - service: script.announce_everywhere
    data:
      message: '"Your 3D Printing Job has started"'
  mode: single
- id: '1613409884927'
  alias: Notify, Voice - 3D Printer - Completed
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.octoprint_printing
    to: 'off'
  condition:
  - condition: state
    entity_id: sensor.davids_cell_do_not_disturb_sensor
    state: 'off'
  action:
  - service: script.announce_everywhere
    data:
      message: '"Your 3D Printing Job is now completed"'
  mode: single
- id: '1613432394530'
  alias: Lights - Studio-Office - AM - On when Fam/Studio/Office motion
  description: Turn on basement lights if there is motion in basement, or in family
    room.
  trigger:
  - type: motion
    platform: device
    device_id: 004463f7dc98142da83bf46edb4a580c
    entity_id: binary_sensor.fam_rm_motion
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: bcd0dc9033fbd84484ed1f97a555cf76
    entity_id: binary_sensor.studio_motion
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 1161a13882e67bbee316a28d7ace2ca6
    entity_id: binary_sensor.office_motion
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: dcf0c85340207727cdda037e63bc5d18
    entity_id: binary_sensor.ezm_2_breakfast_room_motion
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  - condition: state
    entity_id: input_boolean.light_automations_office_enabled
    state: 'on'
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: binary_sensor.is_morning_dark_or_dawn_or_sunrise
    state: 'on'
  action:
  - scene: scene.basement_light_low
  - wait_for_trigger:
    - platform: state
      entity_id: group.floor_0_motion
      to: 'off'
      for: 00:02:00
    timeout: 00:05:00
  - scene: scene.basement_light_off
  mode: restart
- id: '1613433599208'
  alias: Lights - Floor 1 & 2 - AM - Off when Office motion
  description: Turn off Upstairs and Main floor lights if there is office motion.
  trigger:
  - type: motion
    platform: device
    device_id: 1161a13882e67bbee316a28d7ace2ca6
    entity_id: binary_sensor.office_motion
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  - condition: state
    entity_id: binary_sensor.is_morning_dark_or_dawn_or_sunrise
    state: 'on'
  - condition: or
    conditions:
    - condition: state
      entity_id: light.mbr_light
      state: 'on'
    - condition: state
      entity_id: light.stairs_light
      state: 'on'
    - condition: state
      entity_id: light.family_rm_light
      state: 'on'
    - condition: state
      entity_id: light.track_light
      state: 'on'
    - condition: state
      entity_id: light.breakfast_rm_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_light
      state: 'on'
    - condition: state
      entity_id: light.dining_rm_light
      state: 'on'
  action:
  - scene: scene.1st_floor_light_off
  - scene: scene.2nd_floor_light_off
  mode: restart
- id: '1614087791921'
  alias: zz-Bed Occ - copy previous status 1 to status 2
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.bedocc_status_1
  condition: []
  action:
  - service: input_text.set_value
    data:
      value: '{{ trigger.from_state.state }}'
    entity_id: input_text.bedocc_status_2
  mode: single
- id: '1614100390000'
  alias: zz-Bed Occ - copy previous status 2 to status 3
  description: ''
  trigger:
  - platform: state
    entity_id: input_text.bedocc_status_2
  condition: []
  action:
  - service: input_text.set_value
    data:
      value: '{{ trigger.from_state.state }}'
    entity_id: input_text.bedocc_status_3
  mode: single
- id: '1614100603791'
  alias: zz-Bed Occ - copy previous status 3 to status 4
  description: ''
  trigger:
  - platform: state
    entity_id: input_text.bedocc_status_3
  condition: []
  action:
  - service: input_text.set_value
    data:
      value: '{{ trigger.from_state.state }}'
    entity_id: input_text.bedocc_status_4
  mode: single
- id: '1614216935760'
  alias: 'Notify, Voice - Say "Good morning" when first 1st Floor Motion '
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 004463f7dc98142da83bf46edb4a580c
    entity_id: binary_sensor.fam_rm_motion
    domain: binary_sensor
  - platform: state
    entity_id: group.kitchen_breakfast_motion
    to: 'on'
  condition:
  - condition: time
    after: 04:00:00
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  - condition: time
    before: 08:30:00
  - condition: template
    value_template: '{{ as_timestamp(now()) - (as_timestamp(state_attr("automation.announce_good_morning",
      "last_triggered")) or 0) > (3600*3) }}'
  action:
  - service: tts.google_translate_say
    data:
      entity_id: media_player.family_room_home
      message: Good morning, David!
  mode: single
  max: 2
- id: '1614498792999'
  alias: Tag MBR Tag is scanned
  description: ''
  trigger:
  - platform: tag
    tag_id: 8eb27b56-a90a-48f4-b5bd-ff71fc5c3d3e
  condition: []
  action:
  - service: light.turn_on
    data: {}
    target:
      entity_id: light.mbr_light
  mode: single
- id: '1614689741833'
  alias: Notify, Lights - Leave desk every so often
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 1161a13882e67bbee316a28d7ace2ca6
    entity_id: binary_sensor.office_motion
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  condition:
  - condition: state
    entity_id: binary_sensor.studio_motion
    state: 'off'
    for: 02:00:00
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  action:
  - repeat:
      count: '4'
      sequence:
      - type: turn_on
        device_id: 13ade04b2bd14f3bae908a70734f03f1
        entity_id: light.studio_light
        domain: light
        brightness_pct: 100
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 800
      - type: turn_off
        device_id: 13ade04b2bd14f3bae908a70734f03f1
        entity_id: light.studio_light
        domain: light
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 800
  mode: single
- id: '1614891094234'
  alias: 'zy-Housekeeping: Mute pwned password notification'
  description: ''
  trigger:
  - platform: event
    event_type: call_service
    event_data:
      domain: persistent_notification
      service: create
  condition:
  - condition: template
    value_template: '{{ ''supervisor_issue_pwned_core_samba'' in (trigger.event.data.service_data.notification_id
      | default('''')) }}'
  - condition: time
    after: 02:00
    before: '23:59'
  action:
  - service: persistent_notification.dismiss
    data:
      notification_id: '{{ trigger.event.data.service_data.notification_id }}'
  mode: single
- id: '1614898567897'
  alias: Lights - Kitchen-Breakfast - Evening - On/Off when motion (with script)
  description: ''
  trigger:
  - platform: state
    entity_id: group.kitchen_breakfast_motion
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  - condition: state
    entity_id: binary_sensor.is_evening_dark
    state: 'on'
  - condition: and
    conditions:
    - condition: state
      entity_id: light.breakfast_rm_light
      state: 'off'
    - condition: state
      entity_id: light.kitchen_light
      state: 'off'
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: group.family_rm_tv_on
          state: 'off'
        - condition: state
          entity_id: light.family_rm_light
          state: 'on'
        - condition: state
          entity_id: light.track_light
          state: 'on'
      sequence:
      - service: script.lights_to_level_kitchen_breakfast
        data:
          to_brightness: 90
    - conditions:
      - condition: state
        entity_id: group.family_rm_tv_on
        state: 'on'
      sequence:
      - service: script.lights_to_level_kitchen_breakfast
        data:
          to_brightness: 20
      - service: notify.persistent_notification
        data:
          title: Option 2 - Tv is On
          message: TV is on, Lights to Low
    default: []
  - wait_for_trigger:
    - platform: state
      entity_id: group.kitchen_breakfast_motion
      to: 'off'
    timeout: 00:06:00
  - service: script.lights_to_level_kitchen_breakfast
    data:
      to_brightness: 0
  mode: restart
- id: '1614995278494'
  alias: 00 Harmony Family Room Hub changes state test1
  description: ''
  trigger:
  - platform: state
    entity_id: remote.family_room_hub
  - platform: state
    entity_id: switch.family_room_hub_watch_tivo
  condition: []
  action:
  - service: notify.persistent_notification
    data:
      title: Fam Hub State change (t1)
      message: "Name: {{ trigger.to_state.name }},\nState: {{ trigger.from_state.state\
        \ }} to {{ trigger.to_state.state }}, \nEntityID: {{ trigger.entity_id }}"
  mode: parallel
  max: 10
- id: '1615040428904'
  alias: 00 Harmony Family Room Hub changes state to/from Unavailable (Sync, but no
    REST call)
  description: Next step is to add in a "for" on the trigger
  trigger:
  - platform: state
    entity_id: remote.family_room_hub
    to: unavailable
  - platform: state
    entity_id: remote.family_room_hub
    from: unavailable
  condition: []
  action:
  - service: notify.persistent_notification
    data:
      title: Fam Hub is {{ trigger.to_state.state }}
      message: "Name: {{ trigger.to_state.name }},\nState: {{ trigger.from_state.state\
        \ }} to {{ trigger.to_state.state }}, \nEntityID: {{ trigger.entity_id }}\
        \ - attempting resync.  \nPlease reload the integration."
  - service: harmony.sync
    data:
      entity_id: remote.family_room_hub
  mode: parallel
  max: 10
- id: '1615149047434'
  alias: 00 Harmony Family Room Hub changes state to/from Unavailable (REST CALL)
  description: Next step is to add in a "for" on the trigger
  trigger:
  - platform: state
    entity_id: remote.family_room_hub
    to: unavailable
  - platform: state
    entity_id: remote.family_room_hub
    from: unavailable
  condition: []
  action:
  - service: notify.persistent_notification
    data:
      title: Fam Hub is Unavailable
      message: "Name: {{ trigger.to_state.name }},\nState: {{ trigger.from_state.state\
        \ }} to {{ trigger.to_state.state }}, \nEntityID: {{ trigger.entity_id }}\
        \ - attempting resync.  \nPlease reload the integration."
  - service: harmony.sync
    data:
      entity_id: remote.family_room_hub
  mode: parallel
  max: 10
- id: '1615410820791'
  alias: 'zy-Housekeeping: Un-Ack Front Perimeter Ack after <Unack Minutes>'
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.perimeter_front_open_ack
    to: 'on'
    for: 0:{{ states('input_number.perim_front_open_unack_mins')  | round(0) }}:00
  - platform: state
    entity_id: group.perimeter_front_open
    to: 'off'
  - platform: state
    entity_id: input_number.perim_front_open_unack_mins
  condition:
  - condition: state
    entity_id: input_boolean.perimeter_front_open_ack
    state: 'on'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.perimeter_front_open_ack
  - service: notify.persistent_notification
    data:
      title: Front Perimeter Open-ACK now Unacked
      message: Front Perimeter Open-ACK now Unacked
  mode: single
- id: '1615410882193'
  alias: 'zy-Housekeeping: Un-Ack Back Perimeter Ack after <Unack Minutes>'
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.perimeter_back_open_ack
    to: 'on'
    for: 0:{{ states('input_number.perim_back_open_unack_mins') | round(0) }}:00
  - platform: state
    entity_id: group.perimeter_back_open
    to: 'off'
  - platform: state
    entity_id: input_number.perim_back_open_unack_mins
  condition:
  - condition: state
    entity_id: input_boolean.perimeter_back_open_ack
    state: 'on'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id:
      - input_boolean.perimeter_back_open_ack
  - service: notify.persistent_notification
    data:
      title: Back Perimeter Open-ACK now Unacked
      message: Back Perimeter Open-ACK now Unacked
  mode: single
- id: '1615954123805'
  alias: Tag MBR 2nd tag is scanned
  description: ''
  trigger:
  - platform: tag
    tag_id: 7054ad4a-8b2c-4d29-8d9c-a83b4aebc516
  condition: []
  action:
  - service: light.turn_off
    target:
      entity_id:
      - light.basement_lights_group
      - light.floor_1_lights_group
      - light.floor_2_lights_group
    data:
      transition: 2
  mode: single
- id: '1616130801284'
  alias: 'zy-Housekeeping: Re-enable Announcements after 1 hour'
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.announcements_enabled
    to: 'off'
    for: 01:00:00
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.announcements_enabled
  - service: notify.persistent_notification
    data:
      title: Announcements Re-enabled
      message: Announcements Re-enabled.
  - service: script.announce_everywhere
    data:
      message: Announcements have been re-enabled.
  mode: single
- id: '1616670823625'
  alias: Lights - Bedroom - AM
  description: Turn on MBR Lights low when first get out of bed.
  trigger:
  - platform: state
    entity_id: binary_sensor.bed_occupied
    from: 'on'
    to: 'off'
    for: 00:00:02
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
    after: 00:00:00
  - condition: sun
    before: sunrise
    before_offset: +00:15:00
  action:
  - service: notify.notify
    data:
      message: Out of bed, MBR Lights turned on low
      title: Out of bed
  - service: persistent_notification.create
    data:
      title: David is out of bed
      message: Out of bed, turning on lights low for a bit.
  - type: turn_on
    device_id: 2876947463a17fcde130a8fac4ea5bfa
    entity_id: light.mbr_light
    domain: light
    brightness_pct: 17
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.upstairs_motion
      to: 'on'
    - platform: state
      entity_id: binary_sensor.bed_occupied
      from: 'off'
      to: 'on'
    timeout: 00:15:00
  - type: turn_off
    device_id: 2876947463a17fcde130a8fac4ea5bfa
    entity_id: light.mbr_light
    domain: light
  mode: single
- id: '1616881920814'
  alias: Notify, Voice - Perimeter Back open too long (v2)
  description: ''
  trigger:
  - platform: state
    entity_id: group.perimeter_back_open
    to: 'on'
    for: 00:04:00
  condition:
  - condition: state
    entity_id: input_boolean.perimeter_back_open_ack
    state: 'off'
  action:
  - repeat:
      while:
      - condition: state
        entity_id: group.perimeter_back_open
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.perimeter_back_open_ack
            state: 'off'
          sequence:
          - service: persistent_notification.create
            data:
              title: Back door or window open
              message: Back perimeter is open.
              notification_id: back_perim_open
          - service: notify.mobile_app_davids_cell
            data:
              title: Back door or window open
              message: Back perimeter is open for too long.
              data:
                ttl: 0
                priority: high
                channel: urgent
                actions:
                - action: do_nothing
                  title: Dismiss
                - action: ACKNOWLEDGE_BACK_PERIM
                  title: ACK/Silence
                - action: URI
                  title: Open in App
                  uri: /dsba-db/home
          - service: script.announce_everywhere
            data:
              message: "Attention. The following doors has been open for too long.\n\
                \                  {% if is_state('binary_sensor.front_entry_sensor','on')\n\
                \                  %}Front Entry, {% endif %} {% if\n            \
                \      is_state('binary_sensor.garage_door_sensor','on') %}Garage\n\
                \                  Door, {% endif %} {% if\n                  is_state('binary_sensor.garage_entry_sensor','on')\n\
                \                  %}Garage Entry, {% endif %} {% if\n           \
                \       is_state('binary_sensor.sliding_door_sensor','on')\n     \
                \             %}Sliding Door, {% endif %} {% if\n                \
                \  is_state('binary_sensor.office_window_sensor','on')\n         \
                \         %}Office Window, {% endif %} .  Please close, or\n     \
                \             acknowledge in Home Assistant."
        default: []
      - wait_for_trigger:
        - platform: state
          entity_id: group.perimeter_back_open
          to: 'off'
        timeout: 00:03:00
  - service: persistent_notification.create
    data:
      title: Back Perimeter is secure
      message: Back doors and windows are now closed.
      notification_id: back_perim_closed
  - service: script.announce_everywhere
    data:
      message: Back doors and windows have been secured.
  mode: queued
  max: 2
- id: '1616881920816'
  alias: Notify, Voice - Perimeter Front open too long (v2)
  description: ''
  trigger:
  - platform: state
    entity_id: group.perimeter_front_open
    to: 'on'
    for: 00:04:00
  condition:
  - condition: state
    entity_id: input_boolean.perimeter_front_open_ack
    state: 'off'
  action:
  - repeat:
      while:
      - condition: state
        entity_id: group.perimeter_front_open
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.perimeter_front_open_ack
            state: 'off'
          sequence:
          - service: persistent_notification.create
            data:
              title: Front door or window open
              message: Front perimeter is open.
              notification_id: front_perim_open
          - service: notify.mobile_app_davids_cell
            data:
              title: Front door or window open
              message: Front perimeter is open for too long.
              data:
                ttl: 0
                priority: high
                channel: urgent
                actions:
                - action: do_nothing
                  title: Dismiss
                - action: ACKNOWLEDGE_FRONT_PERIM
                  title: ACK/Silence
                - action: URI
                  title: Open in App
                  uri: /dsba-db/home
          - service: script.announce_everywhere
            data:
              message: "Attention. The following doors have been open for too long.\n\
                \                  {% if is_state('binary_sensor.front_entry_sensor','on')\n\
                \                  %}Front Entry, {% endif %} {% if\n            \
                \      is_state('binary_sensor.garage_door_sensor','on') %}Garage\n\
                \                  Door, {% endif %} {% if\n                  is_state('binary_sensor.garage_entry_sensor','on')\n\
                \                  %}Garage Entry, {% endif %} {% if\n           \
                \       is_state('binary_sensor.sliding_door_sensor','on')\n     \
                \             %}Sliding Door, {% endif %} {% if\n                \
                \  is_state('binary_sensor.office_window_sensor','on')\n         \
                \         %}Office Window, {% endif %} .  Please close, or\n     \
                \             acknowledge in Home Assistant."
        default: []
      - wait_for_trigger:
        - platform: state
          entity_id: group.perimeter_front_open
          to: 'off'
        timeout: 00:03:00
  - service: persistent_notification.create
    data:
      title: Front Perimeter is secure
      message: Front doors and windows are now closed.
      notification_id: front_perim_closed
  - service: script.announce_everywhere
    data:
      message: Front doors and windows have been secured.
  mode: queued
  max: 2
- id: '1617576693129'
  alias: Airflow Opened too long - turn Heating/Cooling OFF
  description: ''
  trigger:
  - platform: state
    entity_id: group.airflow_door_or_window_open
    to: 'on'
    for: 00:05:00
  condition:
  - condition: state
    entity_id: climate.david_s_thermostat_nativezone
    state: Circulate
    attribute: fan_mode
  - condition: state
    entity_id: climate.david_s_thermostat_nativezone
    state: auto
  action:
  - service: script.notify_all_in_one
    data:
      title: Open Door - Turning off HVAC
      message: Open window or door.  Turning off the HVAC system.  Again, the A C
        is off.
      announce: 'yes'
      inapp: 'yes'
  - service: climate.set_hvac_mode
    target:
      entity_id: climate.david_s_thermostat_nativezone
    data:
      hvac_mode: 'off'
  - service: climate.set_fan_mode
    data:
      fan_mode: auto
    target:
      entity_id: climate.david_s_thermostat_nativezone
  mode: single
- id: '1617755747066'
  alias: Lights - Kitchen-Breakfast - AM - On when motion
  description: Turn on the main floor when there is motion Upstairs, or on main floor,
    or Studio
  trigger:
  - type: motion
    platform: device
    device_id: 0b2b40ee3db2b0715e441b4fff1aa87b
    entity_id: binary_sensor.upstairs_motion
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 004463f7dc98142da83bf46edb4a580c
    entity_id: binary_sensor.fam_rm_motion
    domain: binary_sensor
  - platform: state
    entity_id: group.kitchen_breakfast_motion
    to: 'on'
  - type: motion
    platform: device
    device_id: bcd0dc9033fbd84484ed1f97a555cf76
    entity_id: binary_sensor.studio_motion
    domain: binary_sensor
  condition:
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  - condition: state
    entity_id: binary_sensor.is_morning_dark_or_dawn_or_sunrise
    state: 'on'
  - condition: and
    conditions:
    - condition: state
      entity_id: light.breakfast_rm_light
      state: 'off'
    - condition: state
      entity_id: light.kitchen_light
      state: 'off'
  action:
  - service: script.lights_to_level_kitchen_breakfast
    data:
      to_brightness: 90
  - wait_for_trigger:
    - platform: state
      entity_id: group.floor_1_2_motion
      to: 'off'
      for: 00:06:00
    timeout: 00:20:00
  - service: script.lights_to_level_kitchen_breakfast
    data:
      to_brightness: 0
  mode: restart
  max: 2
- id: '1618009658525'
  alias: Airflow Closed - Heating/Cooling ON
  description: ''
  trigger:
  - platform: state
    entity_id: group.airflow_door_or_window_open
    to: 'off'
    for: 00:02:00
  condition:
  - condition: state
    entity_id: climate.david_s_thermostat_nativezone
    state: Auto
    attribute: fan_mode
  - condition: state
    entity_id: climate.david_s_thermostat_nativezone
    state: 'off'
  action:
  - service: script.notify_all_in_one
    data:
      title: Door Closed - turning on HVAC
      message: Doors and windows are now closed.  Turning HVAC to Auto mode.
      announce: 'yes'
      inapp: 'yes'
  - service: climate.set_hvac_mode
    target:
      entity_id: climate.david_s_thermostat_nativezone
    data:
      hvac_mode: auto
  - service: climate.set_fan_mode
    data:
      fan_mode: circulate
    target:
      entity_id: climate.david_s_thermostat_nativezone
  mode: single
- id: '1618079132150'
  alias: 'zy-Housekeeping: Reload ISY if unavailable'
  description: ''
  trigger:
  - platform: state
    entity_id: light.stairs_light
    to: unavailable
    for: 00:03:00
  condition: []
  action:
  - service: isy994.reload
  - service: notify.persistent_notification
    data:
      title: ISY Reload Issued
      message: Stairs was marked unavailable for 3m so reloaded the devices.
  mode: single
- id: '1618685426781'
  alias: 'zy-Housekeeping: Re-enable Light Automations (Office) after 1 hour'
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.light_automations_office_enabled
    to: 'off'
    for: 01:00:00
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id:
      - input_boolean.light_automations_office_enabled
  - service: notify.persistent_notification
    data:
      title: Office Light Automations Re-enabled
      message: Office Light Automations Re-enabled.
  - service: script.announce_everywhere
    data:
      message: Office Light automations have been re-enabled.
  mode: single
- id: '1619477154630'
  alias: 'zx - APP  Event: Acknowledge Back Perimeter'
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: ACKNOWLEDGE_BACK_PERIM
  condition: []
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.perimeter_back_open_ack
  - service: script.announce_everywhere
    data:
      message: Back Perimeter has been acknowledged.
  mode: single
- id: '1619477154629'
  alias: 'zx - APP Event: Acknowledge Front Perimeter'
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: ACKNOWLEDGE_FRONT_PERIM
  condition: []
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.perimeter_front_open_ack
  - service: script.announce_everywhere
    data:
      message: Front Perimeter has been acknowledged.
  mode: single
- id: '1619568005949'
  alias: Notify, Voice - Garage Door Up - David is Away [Urgent]
  description: ''
  trigger:
  - platform: state
    entity_id: device_tracker.davids_cell
    to: not_home
    for: 00:00:15
  - platform: state
    entity_id: person.david
    to: away
    for: 00:00:15
  - platform: state
    entity_id: device_tracker.davids_bt_cell
    to: not_home
    for: 00:00:15
  condition:
  - condition: state
    entity_id: binary_sensor.garage_door_sensor
    state: 'on'
  action:
  - repeat:
      while:
      - condition: state
        entity_id: binary_sensor.garage_door_sensor
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.garage_open_ack
            state: 'off'
          sequence:
          - service: script.notify_all_in_one
            data:
              title: Garage Door Left Open
              message: Garage Door Open and You're Not Home!
              tts: 'yes'
              channel: critical
              importance: high
              inapp: 'yes'
              announce: 'no'
        default: []
      - wait_for_trigger:
        - platform: state
          entity_id: binary_sensor.garage_door_sensor
          to: 'off'
        - platform: state
          entity_id: device_tracker.davids_cell
          to: home
        timeout: 00:01:30
  - service: script.notify_all_in_one
    data:
      title: Garage Door Now Closed
      message: Garage Door has been Closed.
      tts: 'yes'
      channel: urgent
      importance: high
      inapp: 'yes'
      announce: 'no'
  mode: single
- id: '1619809477000'
  alias: 'zy-Housekeeping: Un-Ack Garage Door Ack after 1 Hour'
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.garage_open_ack
    to: 'on'
    for: 01:00:00
  - platform: state
    entity_id: group.perimeter_front_open
    to: 'off'
  condition:
  - condition: state
    entity_id: input_boolean.garage_open_ack
    state: 'on'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id:
      - input_boolean.garage_open_ack
  - service: notify.persistent_notification
    data:
      title: Garage Door Open-ACK now Unacked
      message: Garage Door Open-ACK now Unacked
  mode: single
- id: '1620964725197'
  alias: 00 - Lights - WLED Kitchen On
  description: ''
  trigger:
  - platform: state
    entity_id: group.floor_1_motion
    to: 'on'
    for: 00:00:10
  condition:
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  - condition: state
    entity_id: binary_sensor.is_evening_sunset_or_dusk_or_dark
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.ezm_2_breakfast_room_illuminance
    below: '24'
  - condition: state
    entity_id: light.wled_kitchen_master
    state: 'off'
  action:
  - service: light.turn_on
    target:
      entity_id: light.wled_kitchen_master
  mode: single
- id: '1621027622686'
  alias: 00 - Lights - WLED Kitchen Off
  description: ''
  trigger:
  - platform: state
    entity_id: group.floor_1_motion
    for: 00:10:00
    to: 'off'
  - platform: state
    entity_id: binary_sensor.harmony_family_room_off
    for: 00:10:00
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.light_automations_enabled
    state: 'on'
  - condition: state
    entity_id: binary_sensor.is_evening_sunset_or_dusk_or_dark
    state: 'on'
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.harmony_family_room_off
      state: 'on'
      for: 00:09:58
    - condition: state
      entity_id: group.floor_1_motion
      state: 'off'
      for: 00:09:58
  - condition: state
    entity_id: light.wled_kitchen_master
    state: 'on'
  action:
  - service: light.turn_off
    target:
      entity_id: light.wled_kitchen_master
  mode: single
