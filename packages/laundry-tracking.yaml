laundry_tracking:
  sensor:
    - platform: template
      sensors:
        laundry_motion_changed:
          friendly_name: Laundry Motion state-change
          value_template: >
            {{ state_attr('input_datetime.laundry_motion_last_changed','timestamp') | timestamp_custom("%a %m-%d %H:%M") }}
        laundry_vibration_changed:
          friendly_name: Laundry Vibration state-change
          value_template: >
            {{ state_attr('input_datetime.laundry_vibration_last_changed','timestamp') | timestamp_custom("%a %m-%d %H:%M") }}

  input_datetime:
    # These are used to persist change-times that sensors don't keep between reboots:
    laundry_motion_last_changed:
      name: Last Laundry Motion State Change
      has_date: true
      has_time: true
      # Don't set 'inital', as it will reset to this on each startup.
      # initial: 2021-01-01 00:00:00
    laundry_vibration_last_changed:
      name: Last Laundry Vibration State Change
      has_date: true
      has_time: true
      # Don't set 'inital', as it will reset to this on each startup.
      # initial: 2021-01-01 00:00:00


  automation:
    - id: '1614487909002'
      alias: 'Persist the Last Laundry Motion State Change'
      description: ''
      trigger:
      - platform: state
        entity_id: binary_sensor.laundry_motion
        from: 'on'
        to: 'off'
      - platform: state
        entity_id: binary_sensor.laundry_motion
        from: 'off'
        to: 'on'
      condition: []
      action:
      - service: input_datetime.set_datetime
        data:
          datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
        entity_id: input_datetime.laundry_motion_last_changed
      mode: restart
    - id: '1614488031002'
      alias: 'Persist the Last Laundry Vibration State Change'
      description: ''
      trigger:
      - platform: state
        entity_id: binary_sensor.laundry_vibration
        from: 'on'
        to: 'off'
      - platform: state
        entity_id: binary_sensor.laundry_vibration
        from: 'off'
        to: 'on'
      condition: []
      action:
      - service: input_datetime.set_datetime
        data:
          datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
        entity_id: input_datetime.laundry_vibration_last_changed
      mode: restart
