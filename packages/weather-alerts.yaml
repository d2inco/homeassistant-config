weather_alerts:


  sensor:
  - platform: weatheralerts
    state: CO
    zone: 240
    county: '035'
    scan_interval: '060'

  #
  # Most of this is from: https://github.com/custom-components/weatheralerts/blob/master/packages/weatheralerts_1.yaml
  #

  - platform: template
    sensors:
      dougco_wx_alerts_active_alerts:
        ## You can add your county or city name to friendly_name for personalization
        ## For example: Weather Alerts for YourCountyName
        friendly_name: Weather Alerts
        unit_of_measurement: Alerts
        icon_template: mdi:alert-rhombus
        value_template: >-
            {% set alerts_total = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0 %}
                  {% set alerts_total.count = alerts_total.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ alerts_total.count }}
        attribute_templates:
          warning_count: >-
            {% set warnings = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if 'warning' in alert.event.lower() and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set warnings.count = warnings.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ warnings.count }}
          watch_count: >-
            {% set watches = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if 'watch' in alert.event.lower() and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set watches.count = watches.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ watches.count }}
          advisory_count: >-
            {% set advisories = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if 'advisory' in alert.event.lower() and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set advisories.count = advisories.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ advisories.count }}
          statement_count: >-
            {% set statements = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if 'statement' in alert.event.lower() and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set statements.count = statements.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ statements.count }}
          outlook_count: >-
            {% set outlooks = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if 'outlook' in alert.event.lower() and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set outlooks.count = outlooks.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ outlooks.count }}
          alert_count: >-
            {% set alerts = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if 'alert' in alert.event.lower() and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set alerts.count = alerts.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ alerts.count }}
          message_count: >-
            {% set messages = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if 'message' in alert.event.lower() and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set messages.count = messages.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ messages.count }}
          important_count: >-
            {% set important = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if ('emergency' in alert.event.lower() or 'danger' in alert.event.lower() or 'immediate' in alert.event.lower()) and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set important.count = important.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ important.count }}
          test_count: >-
            {% set test = namespace(count=0) %}
            {% if (state_attr('sensor.dougco_wx_alerts', 'alerts')) %}
              {% for alert in state_attr('sensor.dougco_wx_alerts', 'alerts') %}
                {% if 'Test' in alert.event and (as_timestamp(alert['endsExpires']) - as_timestamp(now()) > 0) %}
                  {% set test.count = test.count + 1 %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ test.count }}

      dougco_wx_alerts_alert_1:
        friendly_name: Weather Alert 1
        icon_template: mdi:alert-rhombus
        value_template: >-
          {% if (states('sensor.dougco_wx_alerts') != 'unavailable') and (state_attr('sensor.dougco_wx_alerts', 'alerts')[0] != null) or ((states('sensor.dougco_wx_alerts') == 'unavailable') and (as_timestamp(state_attr('sensor.dougco_wx_alerts', 'alerts')[0].endsExpires) - as_timestamp(now()) > 0)) %}
            on
          {% else %}
            off
          {% endif %}
        attribute_templates:
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].id }}
            {% else %}
              None
            {% endif %}
          alert_event: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].event }}
            {% else %}
              None
            {% endif %}
          alert_area: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].area }}
            {% else %}
              None
            {% endif %}
          alert_NWSheadline: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}
            {% else %}
              None
            {% endif %}
          alert_description: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].description  }}
            {% else %}
              None
            {% endif %}
          alert_messageType: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].messageType }}
            {% else %}
              None
            {% endif %}
          alert_status: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].status }}
            {% else %}
              None
            {% endif %}
          alert_category: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].category }}
            {% else %}
              None
            {% endif %}
          alert_urgency: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].urgency }}
            {% else %}
              None
            {% endif %}
          alert_severity: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].severity }}
            {% else %}
              None
            {% endif %}
          alert_certainty: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].certainty }}
            {% else %}
              None
            {% endif %}
          alert_response: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].response }}
            {% else %}
              None
            {% endif %}
          alert_instruction: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].instruction }}
            {% else %}
              None
            {% endif %}
          alert_sent: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].sent }}
            {% else %}
              None
            {% endif %}
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].effective }}
            {% else %}
              None
            {% endif %}
          alert_onset: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].onset }}
            {% else %}
              None
            {% endif %}
          alert_expires: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].expires }}
            {% else %}
              None
            {% endif %}
          alert_title: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].title }}
            {% else %}
              None
            {% endif %}
          alert_zoneid: >-
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].zoneid }}
            {% else %}
              None
            {% endif %}
          display_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].title }}
            {% else %}
              None
            {% endif %}
          display_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[0].NWSheadline != "null" %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}<br>
              {% endif %}
              <br>{{ states.sensor.dougco_wx_alerts.attributes.alerts[0].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}</ul><br>
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[0].instruction != None %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}<br>
              {% endif %}
              <br>Where : {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
              <br>Effective: {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].effective }}
              {%- if states.sensor.dougco_wx_alerts.attributes.alerts[0].ends != None %}
                <br>Ends: {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].ends }}
              {%- endif %}
              <br>Expires: {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].expires }}
            {% else %}
              None
            {% endif %}
          spoken_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              Attention!!! Weather alert for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}. A {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].title }}. {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') | capitalize }}.
            {% else %}
              None
            {% endif %}
          spoken_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 0 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_1') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[0].instruction != None %}
                {{ states.sensor.dougco_wx_alerts.attributes.alerts[0].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% endif %}
            {% else %}
              None
            {% endif %}
      dougco_wx_alerts_alert_2:
        friendly_name: Weather Alert 2
        icon_template: mdi:alert-rhombus
        value_template: >-
          {% if (states('sensor.dougco_wx_alerts') != 'unavailable') and (state_attr('sensor.dougco_wx_alerts', 'alerts')[1] != null) or ((states('sensor.dougco_wx_alerts') == 'unavailable') and (as_timestamp(state_attr('sensor.dougco_wx_alerts', 'alerts')[1].endsExpires) - as_timestamp(now()) > 0)) %}
            on
          {% else %}
            off
          {% endif %}
        attribute_templates:
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].id }}
            {% else %}
              None
            {% endif %}
          alert_event: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].event }}
            {% else %}
              None
            {% endif %}
          alert_area: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].area }}
            {% else %}
              None
            {% endif %}
          alert_NWSheadline: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}
            {% else %}
              None
            {% endif %}
          alert_description: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].description  }}
            {% else %}
              None
            {% endif %}
          alert_messageType: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].messageType }}
            {% else %}
              None
            {% endif %}
          alert_status: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].status }}
            {% else %}
              None
            {% endif %}
          alert_category: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].category }}
            {% else %}
              None
            {% endif %}
          alert_urgency: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].urgency }}
            {% else %}
              None
            {% endif %}
          alert_severity: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].severity }}
            {% else %}
              None
            {% endif %}
          alert_certainty: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].certainty }}
            {% else %}
              None
            {% endif %}
          alert_response: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].response }}
            {% else %}
              None
            {% endif %}
          alert_instruction: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].instruction }}
            {% else %}
              None
            {% endif %}
          alert_sent: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].sent }}
            {% else %}
              None
            {% endif %}
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].effective }}
            {% else %}
              None
            {% endif %}
          alert_onset: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].onset }}
            {% else %}
              None
            {% endif %}
          alert_expires: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].expires }}
            {% else %}
              None
            {% endif %}
          alert_title: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].title }}
            {% else %}
              None
            {% endif %}
          alert_zoneid: >-
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].zoneid }}
            {% else %}
              None
            {% endif %}
          display_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].title }}
            {% else %}
              None
            {% endif %}
          display_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[1].NWSheadline != "null" %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}<br>
              {% endif %}
              <br>{{ states.sensor.dougco_wx_alerts.attributes.alerts[1].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}</ul><br>
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[1].instruction != None %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}<br>
              {% endif %}
              <br>Where : {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
              <br>Effective: {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].effective }}
              {%- if states.sensor.dougco_wx_alerts.attributes.alerts[1].ends != None %}
                <br>Ends: {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].ends }}
              {%- endif %}
              <br>Expires: {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].expires }}
            {% else %}
              None
            {% endif %}
          spoken_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              Attention!!! Weather alert for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}. A {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].title }}. {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') | capitalize }}.
            {% else %}
              None
            {% endif %}
          spoken_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 1 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_2') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[1].instruction != None %}
                {{ states.sensor.dougco_wx_alerts.attributes.alerts[1].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% endif %}
            {% else %}
              None
            {% endif %}
      dougco_wx_alerts_alert_3:
        friendly_name: Weather Alert 3
        icon_template: mdi:alert-rhombus
        value_template: >-
          {% if (states('sensor.dougco_wx_alerts') != 'unavailable') and (state_attr('sensor.dougco_wx_alerts', 'alerts')[2] != null) or ((states('sensor.dougco_wx_alerts') == 'unavailable') and (as_timestamp(state_attr('sensor.dougco_wx_alerts', 'alerts')[2].endsExpires) - as_timestamp(now()) > 0)) %}
            on
          {% else %}
            off
          {% endif %}
        attribute_templates:
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].id }}
            {% else %}
              None
            {% endif %}
          alert_event: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].event }}
            {% else %}
              None
            {% endif %}
          alert_area: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].area }}
            {% else %}
              None
            {% endif %}
          alert_NWSheadline: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}
            {% else %}
              None
            {% endif %}
          alert_description: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].description  }}
            {% else %}
              None
            {% endif %}
          alert_messageType: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].messageType }}
            {% else %}
              None
            {% endif %}
          alert_status: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].status }}
            {% else %}
              None
            {% endif %}
          alert_category: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].category }}
            {% else %}
              None
            {% endif %}
          alert_urgency: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].urgency }}
            {% else %}
              None
            {% endif %}
          alert_severity: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].severity }}
            {% else %}
              None
            {% endif %}
          alert_certainty: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].certainty }}
            {% else %}
              None
            {% endif %}
          alert_response: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].response }}
            {% else %}
              None
            {% endif %}
          alert_instruction: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].instruction }}
            {% else %}
              None
            {% endif %}
          alert_sent: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].sent }}
            {% else %}
              None
            {% endif %}
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].effective }}
            {% else %}
              None
            {% endif %}
          alert_onset: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].onset }}
            {% else %}
              None
            {% endif %}
          alert_expires: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].expires }}
            {% else %}
              None
            {% endif %}
          alert_title: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].title }}
            {% else %}
              None
            {% endif %}
          alert_zoneid: >-
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].zoneid }}
            {% else %}
              None
            {% endif %}
          display_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].title }}
            {% else %}
              None
            {% endif %}
          display_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[2].NWSheadline != "null" %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}<br>
              {% endif %}
              <br>{{ states.sensor.dougco_wx_alerts.attributes.alerts[2].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}</ul><br>
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[2].instruction != None %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}<br>
              {% endif %}
              <br>Where : {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
              <br>Effective: {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].effective }}
              {%- if states.sensor.dougco_wx_alerts.attributes.alerts[2].ends != None %}
                <br>Ends: {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].ends }}
              {%- endif %}
              <br>Expires: {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].expires }}
            {% else %}
              None
            {% endif %}
          spoken_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              Attention!!! Weather alert for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}. A {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].title }}. {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') | capitalize }}.
            {% else %}
              None
            {% endif %}
          spoken_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 2 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_3') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[2].instruction != None %}
                {{ states.sensor.dougco_wx_alerts.attributes.alerts[2].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% endif %}
            {% else %}
              None
            {% endif %}
      dougco_wx_alerts_alert_4:
        friendly_name: Weather Alert 4
        icon_template: mdi:alert-rhombus
        value_template: >-
          {% if (states('sensor.dougco_wx_alerts') != 'unavailable') and (state_attr('sensor.dougco_wx_alerts', 'alerts')[3] != null) or ((states('sensor.dougco_wx_alerts') == 'unavailable') and (as_timestamp(state_attr('sensor.dougco_wx_alerts', 'alerts')[3].endsExpires) - as_timestamp(now()) > 0)) %}
            on
          {% else %}
            off
          {% endif %}
        attribute_templates:
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].id }}
            {% else %}
              None
            {% endif %}
          alert_event: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].event }}
            {% else %}
              None
            {% endif %}
          alert_area: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].area }}
            {% else %}
              None
            {% endif %}
          alert_NWSheadline: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}
            {% else %}
              None
            {% endif %}
          alert_description: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].description  }}
            {% else %}
              None
            {% endif %}
          alert_messageType: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].messageType }}
            {% else %}
              None
            {% endif %}
          alert_status: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].status }}
            {% else %}
              None
            {% endif %}
          alert_category: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].category }}
            {% else %}
              None
            {% endif %}
          alert_urgency: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].urgency }}
            {% else %}
              None
            {% endif %}
          alert_severity: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].severity }}
            {% else %}
              None
            {% endif %}
          alert_certainty: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].certainty }}
            {% else %}
              None
            {% endif %}
          alert_response: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].response }}
            {% else %}
              None
            {% endif %}
          alert_instruction: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].instruction }}
            {% else %}
              None
            {% endif %}
          alert_sent: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].sent }}
            {% else %}
              None
            {% endif %}
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].effective }}
            {% else %}
              None
            {% endif %}
          alert_onset: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].onset }}
            {% else %}
              None
            {% endif %}
          alert_expires: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].expires }}
            {% else %}
              None
            {% endif %}
          alert_title: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].title }}
            {% else %}
              None
            {% endif %}
          alert_zoneid: >-
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].zoneid }}
            {% else %}
              None
            {% endif %}
          display_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].title }}
            {% else %}
              None
            {% endif %}
          display_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[3].NWSheadline != "null" %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}<br>
              {% endif %}
              <br>{{ states.sensor.dougco_wx_alerts.attributes.alerts[3].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}</ul><br>
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[3].instruction != None %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}<br>
              {% endif %}
              <br>Where : {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
              <br>Effective: {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].effective }}
              {%- if states.sensor.dougco_wx_alerts.attributes.alerts[3].ends != None %}
                <br>Ends: {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].ends }}
              {%- endif %}
              <br>Expires: {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].expires }}
            {% else %}
              None
            {% endif %}
          spoken_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              Attention!!! Weather alert for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}. A {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].title }}. {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') | capitalize }}.
            {% else %}
              None
            {% endif %}
          spoken_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 3 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_4') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[3].instruction != None %}
                {{ states.sensor.dougco_wx_alerts.attributes.alerts[3].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% endif %}
            {% else %}
              None
            {% endif %}
      dougco_wx_alerts_alert_5:
        friendly_name: Weather Alert 5
        icon_template: mdi:alert-rhombus
        value_template: >-
          {% if (states('sensor.dougco_wx_alerts') != 'unavailable') and (state_attr('sensor.dougco_wx_alerts', 'alerts')[4] != null) or ((states('sensor.dougco_wx_alerts') == 'unavailable') and (as_timestamp(state_attr('sensor.dougco_wx_alerts', 'alerts')[4].endsExpires) - as_timestamp(now()) > 0)) %}
            on
          {% else %}
            off
          {% endif %}
        attribute_templates:
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].id }}
            {% else %}
              None
            {% endif %}
          alert_event: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].event }}
            {% else %}
              None
            {% endif %}
          alert_area: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].area }}
            {% else %}
              None
            {% endif %}
          alert_NWSheadline: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}
            {% else %}
              None
            {% endif %}
          alert_description: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].description  }}
            {% else %}
              None
            {% endif %}
          alert_messageType: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].messageType }}
            {% else %}
              None
            {% endif %}
          alert_status: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].status }}
            {% else %}
              None
            {% endif %}
          alert_category: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].category }}
            {% else %}
              None
            {% endif %}
          alert_urgency: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].urgency }}
            {% else %}
              None
            {% endif %}
          alert_severity: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].severity }}
            {% else %}
              None
            {% endif %}
          alert_certainty: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].certainty }}
            {% else %}
              None
            {% endif %}
          alert_response: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].response }}
            {% else %}
              None
            {% endif %}
          alert_instruction: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].instruction }}
            {% else %}
              None
            {% endif %}
          alert_sent: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].sent }}
            {% else %}
              None
            {% endif %}
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].effective }}
            {% else %}
              None
            {% endif %}
          alert_onset: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].onset }}
            {% else %}
              None
            {% endif %}
          alert_expires: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].expires }}
            {% else %}
              None
            {% endif %}
          alert_title: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].title }}
            {% else %}
              None
            {% endif %}
          alert_zoneid: >-
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].zoneid }}
            {% else %}
              None
            {% endif %}
          display_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].title }}
            {% else %}
              None
            {% endif %}
          display_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[4].NWSheadline != "null" %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') }}<br>
              {% endif %}
              <br>{{ states.sensor.dougco_wx_alerts.attributes.alerts[4].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}</ul><br>
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[4].instruction != None %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}<br>
              {% endif %}
              <br>Where : {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
              <br>Effective: {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].effective }}
              {%- if states.sensor.dougco_wx_alerts.attributes.alerts[4].ends != None %}
                <br>Ends: {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].ends }}
              {%- endif %}
              <br>Expires: {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].expires }}
            {% else %}
              None
            {% endif %}
          spoken_title: >
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              Attention!!! Weather alert for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}. A {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].title }}. {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].NWSheadline | regex_replace('\[\'','') | regex_replace('\'\]','') | capitalize }}.
            {% else %}
              None
            {% endif %}
          spoken_message: >
            {% if states('sensor.dougco_wx_alerts')|int > 4 or (states('sensor.dougco_wx_alerts') == "unavailable" and states('sensor.dougco_wx_alerts_alert_5') == "on") %}
              {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].description | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% if states.sensor.dougco_wx_alerts.attributes.alerts[4].instruction != None %}
                {{ states.sensor.dougco_wx_alerts.attributes.alerts[4].instruction | regex_replace('\n\n','<p>') | regex_replace('\n',' ') | regex_replace('\*','\n*') | regex_replace('<p>','\n\n') }}
              {% endif %}
            {% else %}
              None
            {% endif %}

      dougco_wx_alerts_alert_1_last_changed:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_1') == "on" %}
            {{ states.sensor.dougco_wx_alerts_alert_1.last_updated }}
          {% else %}
            None
          {% endif %}
      dougco_wx_alerts_alert_2_last_changed:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_2') == "on" %}
            {{ states.sensor.dougco_wx_alerts_alert_2.last_updated }}
          {% else %}
            None
          {% endif %}
      dougco_wx_alerts_alert_3_last_changed:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_3') == "on" %}
            {{ states.sensor.dougco_wx_alerts_alert_3.last_updated }}
          {% else %}
            None
          {% endif %}
      dougco_wx_alerts_alert_4_last_changed:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_4') == "on" %}
            {{ states.sensor.dougco_wx_alerts_alert_4.last_updated }}
          {% else %}
            None
          {% endif %}
      dougco_wx_alerts_alert_5_last_changed:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_5') == "on" %}
            {{ states.sensor.dougco_wx_alerts_alert_5.last_updated }}
          {% else %}
            None
          {% endif %}

      dougco_wx_alerts_alert_1_most_recent_active_alert:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_1') == 'on' %}
            {{ state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_event') }}
          {% else %}
            {{ states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') }}
          {% endif %}
        attribute_templates:
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_1') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_effective') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert', 'alert_effective') }}
            {% endif %}
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_1') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_1') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_id') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_1_most_recent_active_alert', 'alert_id') }}
            {% endif %}
      dougco_wx_alerts_alert_2_most_recent_active_alert:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_2') == 'on' %}
            {{ state_attr('sensor.dougco_wx_alerts_alert_2', 'alert_event') }}
          {% else %}
            {{ states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') }}
          {% endif %}
        attribute_templates:
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_2') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_2', 'alert_effective') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert', 'alert_effective') }}
            {% endif %}
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_2') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_2') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_2', 'alert_id') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_2_most_recent_active_alert', 'alert_id') }}
            {% endif %}
      dougco_wx_alerts_alert_3_most_recent_active_alert:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_3') == 'on' %}
            {{ state_attr('sensor.dougco_wx_alerts_alert_3', 'alert_event') }}
          {% else %}
            {{ states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') }}
          {% endif %}
        attribute_templates:
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_3') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_3', 'alert_effective') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert', 'alert_effective') }}
            {% endif %}
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_3') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_3') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_3', 'alert_id') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_3_most_recent_active_alert', 'alert_id') }}
            {% endif %}
      dougco_wx_alerts_alert_4_most_recent_active_alert:
        value_template: >-
            {% if states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_4', 'alert_event') }}
            {% else %}
              {{ states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') }}
            {% endif %}
        attribute_templates:
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_4', 'alert_effective') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert', 'alert_effective') }}
            {% endif %}
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_4') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_4') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_4', 'alert_id') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_4_most_recent_active_alert', 'alert_id') }}
            {% endif %}
      dougco_wx_alerts_alert_5_most_recent_active_alert:
        value_template: >-
          {% if states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
            unavailable
          {% elif states('sensor.dougco_wx_alerts_alert_5') == 'on' %}
            {{ state_attr('sensor.dougco_wx_alerts_alert_5', 'alert_event') }}
          {% else %}
            {{ states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') }}
          {% endif %}
        attribute_templates:
          alert_effective: >-
            {% if states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_5') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_5', 'alert_effective') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert', 'alert_effective') }}
            {% endif %}
          alert_id: >-
            {% if states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == '' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == 'unavailable' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert') == 'unknown' and states('sensor.dougco_wx_alerts_alert_5') != 'on' %}
              unavailable
            {% elif states('sensor.dougco_wx_alerts_alert_5') == 'on' %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_5', 'alert_id') }}
            {% else %}
              {{ state_attr('sensor.dougco_wx_alerts_alert_5_most_recent_active_alert', 'alert_id') }}
            {% endif %}

      dougco_wx_alerts_alerts_are_active:
        friendly_name: Weather Alerts Are Active
        icon_template: mdi:alert-rhombus
        value_template: >
          {% if (states('sensor.dougco_wx_alerts') | int > 0) or ((states('sensor.dougco_wx_alerts') == 'unavailable') and (states('sensor.dougco_wx_alerts_alert_1') == 'on')) %}
            Yes
          {% else %}
            No
          {% endif %}




  ################################################################################
  ## input_text ##

  input_text:
    dougco_wx_alerts_triggered_ui_alert_ids:
      name: Triggered Weather Alert IDs - UI
      icon: mdi:information-variant
      max: 255
      initial: None

#     dougco_wx_alerts_triggered_pushbullet_alert_ids:
#       name: Triggered Weather Alert IDs - Pushbullet
#       icon: mdi:information-variant
#       max: 255
#       initial: None




  ################################################################################
  ## automation ##

  automation:
    ## Automation to trigger a UI notification when there is an active weather alert.
    ## dougco_wx_alerts_alert_1 should always contain most recent alert.
    - alias: Weather Alert UI Notification - 1
      initial_state: 'on'
      trigger:
        - platform: state
          entity_id: sensor.dougco_wx_alerts_alert_1_last_changed
        - platform: homeassistant
          event: start
      condition:
        - condition: and
          conditions:
            - condition: template
              value_template: "{{ states('sensor.dougco_wx_alerts_alerts_are_active') == 'Yes' }}"
            - condition: template
              value_template: "{{ (as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_sent'))) < 3600 }}"
            - condition: template
              value_template: "{{ state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_id') not in states('input_text.dougco_wx_alerts_triggered_ui_alert_ids') }}"
      action:
        - service: script.dougco_wx_alerts_popup_on_wx_alert
          data_template:
            title: >
              {% if (states('sensor.dougco_wx_alerts_alert_1') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_effective'))|float) <= 3600) %}
                {{ state_attr('sensor.dougco_wx_alerts_alert_1', 'display_title') }}
              {% else %}
                Weather Alerts
              {% endif %}
            message: >
              {% if (states('sensor.dougco_wx_alerts_alert_1') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_effective'))|float) <= 3600) %}
                {{ state_attr('sensor.dougco_wx_alerts_alert_1', 'display_message') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_1') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_effective'))|float) > 3600) %}
                <hr>Alert: <br>{{ state_attr('sensor.dougco_wx_alerts_alert_1', 'display_title') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_2') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_2', 'alert_effective'))|float) <= 3600) %}
                <hr>{{ state_attr('sensor.dougco_wx_alerts_alert_2', 'display_title') }}<br>
                {{ state_attr('sensor.dougco_wx_alerts_alert_2', 'display_message') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_2') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_2', 'alert_effective'))|float) > 3600) %}
                <hr>Alert: <br>{{ state_attr('sensor.dougco_wx_alerts_alert_2', 'display_title') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_3') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_3', 'alert_effective'))|float) <= 3600) %}
                <hr>{{ state_attr('sensor.dougco_wx_alerts_alert_3', 'display_title') }}<br>
                {{ state_attr('sensor.dougco_wx_alerts_alert_3', 'display_message') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_3') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_3', 'alert_effective'))|float) > 3600) %}
                <hr>Alert: <br>{{ state_attr('sensor.dougco_wx_alerts_alert_3', 'display_title') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_4') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_4', 'alert_effective'))|float) <= 3600) %}
                <hr>{{ state_attr('sensor.dougco_wx_alerts_alert_4', 'display_title') }}<br>
                {{ state_attr('sensor.dougco_wx_alerts_alert_4', 'display_message') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_4') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_4', 'alert_effective'))|float) > 3600) %}
                <hr>Alert: <br>{{ state_attr('sensor.dougco_wx_alerts_alert_4', 'display_title') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_5') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_5', 'alert_effective'))|float) <= 3600) %}
                <hr>{{ state_attr('sensor.dougco_wx_alerts_alert_5', 'display_title') }}<br>
                {{ state_attr('sensor.dougco_wx_alerts_alert_5', 'display_message') }}
              {% endif %}
              {% if (states('sensor.dougco_wx_alerts_alert_5') == 'on') and ((as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_5', 'alert_effective'))|float) > 3600) %}
                <hr>Alert: <br>{{ state_attr('sensor.dougco_wx_alerts_alert_5', 'display_title') }}
              {% endif %}
        - service: input_text.set_value
          data_template:
            entity_id: input_text.dougco_wx_alerts_triggered_ui_alert_ids
            value: "{{ state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_id') }} {{ state_attr('sensor.dougco_wx_alerts_alert_2', 'alert_id') }} {{ state_attr('sensor.dougco_wx_alerts_alert_3', 'alert_id') }} {{ state_attr('sensor.dougco_wx_alerts_alert_4', 'alert_id') }} {{ state_attr('sensor.dougco_wx_alerts_alert_5', 'alert_id') }}"

      ## Automation to dismiss UI notification if there are no active alerts for 30 minutes
      ## Disable or remove this automation if you don't want notifications to auto-dismiss
    - alias: Weather Alert UI Notification Auto-dismiss - 1
      trigger:
        - platform: state
          entity_id: sensor.dougco_wx_alerts_alerts_are_active
          to: "No"
          for:
            minutes: 30
        - platform: homeassistant
          event: start
      condition:
        - condition: template
          value_template: "{{ states('sensor.dougco_wx_alerts_alerts_are_active') == 'No' }}"
      action:
        - service: persistent_notification.dismiss
          data:
            notification_id: "dougco_wx_alerts_alert"

    ## Automation to push alerts via Pushbullet service
    ## Disable or remove this automation if you don't use Pushbullet
#     - alias: Weather Alerts Pushbullet Notification - 1
#       trigger:
#         platform: state
#         entity_id: sensor.dougco_wx_alerts_alert_1_last_changed
#       condition:
#         - condition: and
#           conditions:
#             - condition: template
#               value_template: "{{ states('sensor.dougco_wx_alerts_alerts_are_active') == 'Yes' }}"
#             - condition: template
#               value_template: "{{ (as_timestamp(now()) - as_timestamp(state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_sent'))) < 3600 }}"
#             - condition: template
#               value_template: "{{ state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_id') not in states('input_text.dougco_wx_alerts_triggered_pushbullet_alert_ids') }}"
#       action:
#         - service: notify.pushbullet_notify
#           data_template:
#             message: >
#               Current NWS Weather Alerts:
#
#               {% if states('sensor.dougco_wx_alerts_alerts_are_active') == "No" %}
#               No alerts at this time for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}.
#               {% endif %}
#               {% if states.sensor.dougco_wx_alerts_alert_1.state == "on" %}
#               {{ states.sensor.dougco_wx_alerts_alert_1.attributes.display_title }} for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
#
#               {% endif %}
#               {% if states.sensor.dougco_wx_alerts_alert_2.state == "on" %}
#               {{ states.sensor.dougco_wx_alerts_alert_2.attributes.display_title }} for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
#
#               {% endif %}
#               {% if states.sensor.dougco_wx_alerts_alert_3.state == "on" %}
#               {{ states.sensor.dougco_wx_alerts_alert_3.attributes.display_title }} for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
#
#               {% endif %}
#               {% if states.sensor.dougco_wx_alerts_alert_4.state == "on" %}
#               {{ states.sensor.dougco_wx_alerts_alert_4.attributes.display_title }} for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
#
#               {% endif %}
#               {% if states.sensor.dougco_wx_alerts_alert_5.state == "on" %}
#               {{ states.sensor.dougco_wx_alerts_alert_5.attributes.display_title }} for {{ state_attr('sensor.dougco_wx_alerts', 'friendly_name') }}
#               {% endif %}
#         - service: input_text.set_value
#           data_template:
#             entity_id: input_text.dougco_wx_alerts_triggered_pushbullet_alert_ids
#             value: "{{ state_attr('sensor.dougco_wx_alerts_alert_1', 'alert_id') }} {{ state_attr('sensor.dougco_wx_alerts_alert_2', 'alert_id') }} {{ state_attr('sensor.dougco_wx_alerts_alert_3', 'alert_id') }} {{ state_attr('sensor.dougco_wx_alerts_alert_4', 'alert_id') }} {{ state_attr('sensor.dougco_wx_alerts_alert_5', 'alert_id') }}"




  ################################################################################
  ## script ##

  script:
    ## Script creates UI notification and is called via automation defined above
    dougco_wx_alerts_popup_on_wx_alert:
      alias: Weather Alert Pop Up - 1
      sequence:
          ## Dismiss any current alert so the UI isn't filled
          ## up with these if there are more then one.
          ## Only show the most recent alert
        - service: persistent_notification.dismiss
          data:
            notification_id: "dougco_wx_alerts_alert"
          ## Create a new persistant notification in the UI for a new alert
        - service_template: >
            {% if states.sensor.dougco_wx_alerts.state != '0' %}
              persistent_notification.create
            {% endif %}
          data_template:
            notification_id: "dougco_wx_alerts_alert"
            message: "{{ message }}"
            title: "{{ title }}"
