notifications:
  #
  ######################################################################
  # Text to speech
  tts:
    # New method for "tts.google_tts"
    - platform: google_translate
      base_url: http://192.168.200.77:8123
      service_name: google_tts

    # Previous iteration for "tts.google_translate_say" (until i can deprecate/remove)
    - platform: google_translate
      base_url: http://192.168.200.77:8123
      service_name: google_translate_say

  # message: required
  # title:   optional
  # target:  optional (platform dependent)
  # data:    optional (platform dependent)

  ######################################################################
  # Notifications
  notify:
    - name: announce_office
      platform: tts
      tts_service: tts.google_tts
      media_player: media_player.office_home
    - name: announce_family_room
      platform: tts
      tts_service: tts.google_tts
      media_player: media_player.family_room_home
    - name: announce_bedroom
      platform: tts
      tts_service: tts.google_tts
      media_player: media_player.bedroom_home

    - name: announce_whole_house
      platform: group
      services:
        - service: announce_office
        - service: announce_family_room
        - service: announce_bedroom

    - name: david_cell_app
      platform: group
      services:
        - service: mobile_app_davids_cell

    - name: everywhere
      platform: group
      services:
        - service: announce_office
        - service: announce_family_room
        - service: announce_bedroom
        - service: mobile_app_davids_cell
        - service: persistent_notification

    - name: push_notification
      platform: html5
      vapid_pub_key: !secret google_firebase_vapid_pub_key
      vapid_prv_key: !secret google_firebase_vapid_prv_key
      vapid_email: !secret google_firebase_vapid_email

    - name: david_email
      platform: smtp
      server: smtp.fastmail.com
      port: 587
      timeout: 20
      encryption: starttls
      username: !secret email_userid
      password: !secret email_password
      sender: !secret email_sender_address
      sender_name: !secret email_sender_name
      recipient:
        - !secret email_send_to

  ######################################################################
  # Scripts
  script:
    critial_everywhere:
      mode: queued
      sequence:
        - service: notify.david_cell_app
          data_template:
            message: "{{ message }}"
            data:
              ttl: 0
              priority: high
              channel: critical
        - service: notify.announce_whole_house
          data_template:
            message: "{{ message }}"

    announce_everywhere:
      alias: Announce Everywhere
      mode: queued
      icon: mdi:volume-high
      sequence:
        - service: tts.google_translate_say
          data_template:
            entity_id: media_player.family_room_home
            message: "{{ message }}"
        - delay:
            hours: 0
            minutes: 0
            seconds: 3
        - service: tts.google_translate_say
          data_template:
            entity_id: media_player.office_home
            message: "{{ message }}"
        - delay:
            hours: 0
            minutes: 0
            seconds: 3
        - service: tts.google_translate_say
          data_template:
            entity_id: media_player.bedroom_home
            message: "{{ message }}"
        - delay:
            hours: 0
            minutes: 0
            seconds: 3
      description: Make a voice-announcement on all Google Home devices
      fields:
        message:
          description: Text to say out loud
          example: Dinner is ready

    notify_all_in_one:
      alias: All-in-one Notification Script
      mode: queued
      icon: mdi:bell-outline
      max: 10
      fields:
        title:
          description: Short Title to display
          example: Important Notification
          default: ""
        message:
          description: Longer text to display
          example: This big thing happened
          default: "Message Here"
          required: true
        notification_id:
          description: "For replaceable/clearable notifications (default: '')"
          example: ''
          default: ''
        tts:
          description: Say message aloud on the phone
          example: 'yes'
          default: 'no'
          required: 'no'
        channel:
          description: "Category for phone notfications (default, urgent, critical)"
          example: default
          default: default
          required: false
        importance:
          description: "Priority for notification (high (sound+HUD), default (sound), low (no-sound), min (no-sound or status))"
          example: default
          default: default
          required: false
        inapp:
          description: Display as in-app notification (yes, no).
          example: 'yes'
          default: 'yes'
        announce:
          description: Read the message aloud, in the house(yes, no)
          example: 'no'
          default: 'no'
      sequence:
        - delay:
            hours: 0
            minutes: 0
            seconds: 0
            milliseconds: 1
        - alias: "if announce"
          choose:
            - conditions: "{{ announce == 'yes' }}"
              sequence:
                - service: script.announce_everywhere
                  data:
                    message: "{{ message }}"
        - alias: "if in-app"
          choose:
            - conditions: "{{ inapp == 'yes' and (notification_id | default('')) == '' }}"
              sequence:
                - service: persistent_notification.create
                  data:
                    title: "{{ title }}"
                    message: "{{ message }} [PC-1]"
                - service: notify.mobile_app_davids_cell
                  data:
                    title: "{{ title }}"
                    message: "{{ message }} [APP-1]"
                    data:
                      ttl: 0
                      channel: "{{ channel | default('default') }}"
                      importance: "{{ importance | default('default') }}"
            - conditions: "{{ inapp == 'yes' and notification_id != '' }}"
              sequence:
                - service: persistent_notification.create
                  data:
                    title: "{{ title }} - id {{ notification_id }}"
                    message: "{{ message }} [PC-2]"
                    notification_id: "{{ notification_id | default('xx') }}"
                - service: notify.mobile_app_davids_cell
                  data:
                    title: "{{ title }}"
                    message: "{{ message }} [APP-2]"
                    data:
                      ttl: 0
                      channel: "{{ channel | default('default') }}"
                      importance: "{{ importance | default('default') }}"
        - alias: "if tts-on-phone"
          choose:
            - conditions: "{{ tts == 'yes' }}"
              sequence:
                - repeat:
                    count: 3
                    sequence:
                      - service: notify.mobile_app_davids_cell
                        data:
                          title: "{{ message }}"
                          message: "TTS"
                          data:
                            channel: alarm_stream_max
                      - delay:
                          hours: 0
                          minutes: 0
                          seconds: 5
